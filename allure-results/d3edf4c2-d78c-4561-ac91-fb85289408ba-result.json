{"name": "test_mbank_transfer", "status": "broken", "statusDetails": {"message": "Exception: Не получено подтверждение успешной операции для банка mbank", "trace": "self = <tests.test_banks_transfers.TestBankTransfers object at 0x0000023A8CEC0230>\nbrowser = <Page url='https://ibank.kicb.net/'>\n\n    @allure.feature(\"Банковские переводы\")\n    @allure.story(\"Переводы в MBank\")\n    def test_mbank_transfer(self, browser):\n        \"\"\"Тест перевода в MBank\"\"\"\n        with allure.step(\"Выполняем перевод в MBank\"):\n            page = browser\n            banks_page = BanksTransfersPage(page)\n            banks_page.open_banks_transfers()\n>           banks_page.transfer_to_bank(\"mbank\", \"996555515516\")\n\nProdWeb\\tests\\test_banks_transfers.py:25: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nProdWeb\\pages\\banks_transfers_page.py:77: in transfer_to_bank\n    has_error = self.handle_payment_buttons(bank_key, amount)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <pages.banks_transfers_page.BanksTransfersPage object at 0x0000023A8D53B980>\nbank_key = 'mbank', amount = 20\n\n    def handle_payment_buttons(self, bank_key: str, amount: int):\n        \"\"\"Обрабатывает нажатие кнопок оплаты и подтверждения\"\"\"\n        try:\n            # Проверка кнопки оплаты\n            if not self.page.locator(\"//button [contains(text(), 'Оплатить')]\").is_visible(timeout=5000):\n                raise ButtonNotFoundError(f\"Кнопка Оплатить не найдена для банка {bank_key}\", bank=bank_key)\n            self.page.locator(\"//button [contains(text(), 'Оплатить')]\").click()\n            print(f\"Нажата кнопка Оплатить для банка {bank_key}\")\n    \n            # Даем время для появления ошибки или кнопки подтверждения\n            sleep(2)\n    \n            # Проверяем ошибку минимального лимита\n            error_message = \"//span [contains(text(), 'Сумма меньше минимального лимита.')]\"\n            if self.page.locator(error_message).is_visible(timeout=2000):\n                print(f\"Обнаружена ошибка минимального лимита для банка {bank_key}\")\n                return True\n    \n            # Проверяем разные варианты кнопок подтверждения\n            confirm_buttons = [\n                \"//button [contains(text(), 'Отправить на подтверждение')]\",\n                \"//button [contains(text(), 'Подтвердить')]\"\n            ]\n    \n            button_found = False\n            for button in confirm_buttons:\n                if self.page.locator(button).is_visible(timeout=2000):\n                    self.page.locator(button).click()\n                    print(f\"Нажата кнопка подтверждения '{button}' для банка {bank_key}\")\n                    button_found = True\n                    break\n    \n            if not button_found:\n                raise ButtonNotFoundError(f\"Кнопка подтверждения не найдена для банка {bank_key}\", bank=bank_key)\n    \n            # Ждем появления либо поля OTP, либо сообщения об успехе\n            sleep(2)\n    \n            # Проверяем наличие поля ввода OTP\n            otp_input = \"//input[contains(@placeholder, 'Введите код')]\"\n            if self.page.locator(otp_input).is_visible(timeout=3000):\n                print(f\"Обнаружено поле ввода OTP для банка {bank_key}\")\n    \n                # Получаем и вводим OTP код\n                otp_code = self.get_otp_code()\n    \n                # Проверяем, что поле все еще видимо перед вводом\n                if not self.page.locator(otp_input).is_visible():\n                    raise Exception(f\"Поле ввода OTP исчезло для банка {bank_key}\")\n    \n                # Вводим код\n                self.page.locator(otp_input).fill(otp_code)\n                print(f\"OTP код {otp_code} введен для банка {bank_key}\")\n    \n                # Нажимаем кнопку подтверждения OTP\n                confirm_otp = \"//button[contains(text(), 'Подтвердить')]\"\n                if self.page.locator(confirm_otp).is_visible(timeout=2000):\n                    self.page.locator(confirm_otp).click()\n                    print(\"Нажата кнопка подтверждения OTP\")\n    \n                # Ждем сообщение о принятии к обработке\n                processing_message = \"//div[contains(text(), 'принят к обработке')]\"\n                if not self.page.locator(processing_message).is_visible(timeout=5000):\n                    raise Exception(f\"Не получено подтверждение обработки платежа для банка {bank_key}\")\n                print(\"Платеж принят к обработке\")\n    \n            else:\n                print(f\"Банк {bank_key} не требует OTP\")\n                # Для банков без OTP ждем успешного завершения\n                success_message = \"//div[contains(text(), 'Операция выполнена успешно')]\"\n                if not self.page.locator(success_message).is_visible(timeout=5000):\n>                   raise Exception(f\"Не получено подтверждение успешной операции для банка {bank_key}\")\nE                   Exception: Не получено подтверждение успешной операции для банка mbank\n\nProdWeb\\pages\\Base_page.py:135: Exception"}, "description": "Тест перевода в MBank", "steps": [{"name": "Выполняем перевод в MBank", "status": "broken", "statusDetails": {"message": "Exception: Не получено подтверждение успешной операции для банка mbank\n", "trace": "  File \"C:\\project_kicb\\ProdWeb\\tests\\test_banks_transfers.py\", line 25, in test_mbank_transfer\n    banks_page.transfer_to_bank(\"mbank\", \"996555515516\")\n  File \"C:\\project_kicb\\ProdWeb\\pages\\banks_transfers_page.py\", line 77, in transfer_to_bank\n    has_error = self.handle_payment_buttons(bank_key, amount)\n                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\project_kicb\\ProdWeb\\pages\\Base_page.py\", line 135, in handle_payment_buttons\n    raise Exception(f\"Не получено подтверждение успешной операции для банка {bank_key}\")\n"}, "start": 1737373755953, "stop": 1737373761671}], "attachments": [{"name": "stdout", "source": "4acec6f0-b8b3-42b0-9ab6-f9ba35c7a939-attachment.txt", "type": "text/plain"}], "start": 1737373755952, "stop": 1737373761671, "uuid": "bdf4b36a-4244-496b-9eb9-b14bc332db51", "historyId": "74d11917e6ecdaca3217af18e572bb2f", "testCaseId": "74d11917e6ecdaca3217af18e572bb2f", "fullName": "tests.test_banks_transfers.TestBankTransfers#test_mbank_transfer", "labels": [{"name": "story", "value": "Переводы в MBank"}, {"name": "feature", "value": "Банковские переводы"}, {"name": "parentSuite", "value": "tests"}, {"name": "suite", "value": "test_banks_transfers"}, {"name": "subSuite", "value": "TestBankTransfers"}, {"name": "host", "value": "DESKTOP-U8CRCDT"}, {"name": "thread", "value": "23932-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "tests.test_banks_transfers"}]}